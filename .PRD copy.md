# LangGraph MCP 호스트 MVP 구현 요구사항 정의서

## 1. 프로젝트 개요

### 1.1 목적
MCP Python SDK를 사용하여 몇 시간 안에 구현 가능한 MCP 호스트 시스템을 구축한다. 사용자가 채팅을 통해 여러 MCP 서버의 도구들을 활용할 수 있는 중간 계층을 제공한다.

### 1.2 MVP 범위
- **포함사항**: MCP 클라이언트, 웹 채팅 UI, FastAPI 백엔드, 예시 날씨 MCP 서버
- **제외사항**: LangGraph, Docker, 관찰성, 복잡한 UI, 인증, 데이터베이스

## 2. 기능 요구사항

### 2.1 핵심 기능 (MVP)

#### 2.1.1 MCP 호스트 클라이언트
- **FR-001**: MCP Python SDK 기반 클라이언트 구현
- **FR-002**: MCP 서버 연결 관리 (stdio 프로토콜)
- **FR-003**: MCP 도구 발견 및 목록 관리
- **FR-004**: MCP 도구 호출 및 결과 처리

#### 2.1.2 웹 채팅 인터페이스
- **FR-005**: 간단한 HTML/JavaScript 채팅 UI
- **FR-006**: WebSocket 기반 실시간 메시지 송수신
- **FR-007**: 사용 가능한 MCP 도구 목록 표시

#### 2.1.3 FastAPI 백엔드
- **FR-008**: WebSocket 엔드포인트 (/ws)
- **FR-009**: 채팅 메시지에서 도구 호출 파싱
- **FR-010**: MCP 클라이언트와 WebSocket 연결

#### 2.1.4 예시 날씨 MCP 서버
- **FR-011**: FastMCP 기반 날씨 서버 구현
- **FR-012**: get_weather 도구 (랜덤 데이터)
- **FR-013**: stdio 프로토콜 지원

## 3. 시스템 아키텍처

### 3.1 MCP 호스트 구조
```
웹 브라우저 (채팅 UI)
       ↕ WebSocket
FastAPI 서버 (MCP 호스트)
       ↕ MCP Python SDK
날씨 MCP 서버 (stdio)
```

### 3.2 파일 구조
```
mcp_host_mvp/
├── host/
│   ├── main.py              # FastAPI MCP 호스트
│   ├── mcp_client.py        # MCP 클라이언트 관리
│   ├── message_parser.py    # 채팅 메시지 파싱
│   └── requirements.txt
├── weather_server/
│   ├── server.py            # FastMCP 날씨 서버
│   └── requirements.txt
├── frontend/
│   └── index.html          # 채팅 UI
└── README.md
```

## 4. 구현 사양

### 4.1 MCP 클라이언트 (mcp_client.py)
```python
from mcp import ClientSession, StdioServerParameters
from mcp.client.stdio import stdio_client

class MCPManager:
    def __init__(self):
        self.sessions = {}
    
    async def connect_server(self, name: str, command: str):
        server_params = StdioServerParameters(
            command=command,
            args=[]
        )
        session = await stdio_client(server_params)
        self.sessions[name] = session
        return session
    
    async def list_tools(self, server_name: str):
        session = self.sessions[server_name]
        return await session.list_tools()
    
    async def call_tool(self, server_name: str, tool_name: str, arguments: dict):
        session = self.sessions[server_name]
        return await session.call_tool(tool_name, arguments)
```

### 4.2 FastAPI 호스트 (main.py)
```python
@app.websocket("/ws")
async def websocket_endpoint(websocket: WebSocket):
    await websocket.accept()
    
    # MCP 서버 연결
    mcp_manager = MCPManager()
    await mcp_manager.connect_server("weather", "python weather_server/server.py")
    
    while True:
        message = await websocket.receive_text()
        
        # 채팅 메시지 파싱
        if "날씨" in message:
            result = await mcp_manager.call_tool("weather", "get_weather", {"city": "서울"})
            await websocket.send_text(f"날씨 정보: {result}")
        elif message == "/tools":
            tools = await mcp_manager.list_tools("weather")
            await websocket.send_text(f"사용 가능한 도구: {tools}")
        else:
            await websocket.send_text(f"응답: {message}")
```

### 4.3 날씨 MCP 서버 (server.py)
```python
from mcp.server.fastmcp import FastMCP

mcp = FastMCP("Weather")

@mcp.tool()
def get_weather(city: str) -> dict:
    """도시의 날씨 정보를 조회합니다."""
    import random
    return {
        "city": city,
        "temperature": random.randint(15, 30),
        "condition": random.choice(["맑음", "흐림", "비"]),
        "humidity": random.randint(40, 80)
    }

if __name__ == "__main__":
    mcp.run()
```

### 4.4 프론트엔드 (index.html)
```html
<!DOCTYPE html>
<html>
<head>
    <title>MCP 호스트 채팅</title>
    <style>
        #messages { height: 400px; overflow-y: scroll; border: 1px solid #ccc; }
        #messageInput { width: 300px; }
    </style>
</head>
<body>
    <h1>MCP 호스트 채팅</h1>
    <div id="messages"></div>
    <input id="messageInput" type="text" placeholder="메시지 입력... (/tools로 도구 목록)">
    <button onclick="sendMessage()">전송</button>
    
    <script>
        const ws = new WebSocket('ws://localhost:8000/ws');
        const messages = document.getElementById('messages');
        
        ws.onmessage = function(event) {
            messages.innerHTML += '<div>' + event.data + '</div>';
            messages.scrollTop = messages.scrollHeight;
        };
        
        function sendMessage() {
            const input = document.getElementById('messageInput');
            ws.send(input.value);
            messages.innerHTML += '<div><strong>나:</strong> ' + input.value + '</div>';
            input.value = '';
        }
    </script>
</body>
</html>
```

## 5. 개발 일정 (4-6시간)

### 5.1 1시간: MCP 서버 구현
- FastMCP 기반 날씨 서버 작성
- get_weather 도구 구현

### 5.2 2시간: MCP 호스트 클라이언트
- MCP Python SDK 클라이언트 구현
- MCP 서버 연결 및 도구 호출 로직

### 5.3 1시간: FastAPI 백엔드
- WebSocket 엔드포인트
- 메시지 파싱 및 도구 호출 연결

### 5.4 1시간: 프론트엔드 & 통합
- HTML/JavaScript 채팅 UI
- 전체 시스템 통합 테스트

### 5.5 1시간: 테스트 및 개선
- 에러 처리 추가
- UI 개선 및 데모 준비

## 6. 기술 스택

### 6.1 MCP 호스트
- **Python 3.11+**
- **MCP Python SDK**: 클라이언트 구현
- **FastAPI**: WebSocket 지원
- **uvicorn**: ASGI 서버

### 6.2 MCP 서버
- **FastMCP**: MCP 서버 구현
- **stdio 프로토콜**: 서버 통신

### 6.3 프론트엔드
- **HTML5/JavaScript**: 간단한 채팅 UI

### 6.4 의존성
```txt
# host/requirements.txt
mcp>=1.0.0
fastapi>=0.104.1
uvicorn>=0.24.0
websockets>=12.0

# weather_server/requirements.txt
mcp>=1.0.0
```

## 7. 실행 방법

```bash
# 1. 날씨 MCP 서버 테스트
cd weather_server
pip install -r requirements.txt
python server.py

# 2. MCP 호스트 실행
cd host
pip install -r requirements.txt
uvicorn main:app --reload

# 3. 프론트엔드 실행
cd frontend
python -m http.server 3000
```

## 8. 데모 시나리오

1. 웹 브라우저에서 `localhost:3000` 접속
2. `/tools` 입력 → 사용 가능한 MCP 도구 목록 확인
3. "서울 날씨 알려줘" 입력 → MCP 서버에서 날씨 데이터 받기
4. 일반 채팅 메시지도 처리 확인

## 9. 확장 계획 (MVP 이후)

- 다중 MCP 서버 연결 지원
- 더 복잡한 도구 파싱 로직
- LangGraph 워크플로우 추가
- React UI 업그레이드
- Docker 컨테이너화

## 10. 결론

이 MVP는 실제 MCP 프로토콜을 사용하는 호스트 시스템으로, 사용자가 채팅을 통해 MCP 서버의 도구들을 활용할 수 있는 기본적인 기능을 제공합니다.
